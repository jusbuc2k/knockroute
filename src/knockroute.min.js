(function(n,t){function r(n,t){var u=this;t=this.options=i.utils.defaults({pathSeperator:"/"},t||{});this.routeTemplate=n;this.elements=r.parseTemplate(n,t.pathSeperator)}function c(){function r(){var t=n.getPath();n.pathChanged.notifySubscribers(t);u=t}var n=this,u="";n.pathChanged=new t.subscribable;n.setPath=function(n){window.location.hash="#"+n};n.getPath=function(){return window.location.hash.slice(1)};n.start=function(){i.utils.attachEvent(window,"hashchange",r);r()};n.stop=function(){i.utils.detachEvent(window,"hashchange",r)};n.revert=function(t){n.setPath(u);typeof t=="function"&&window.setTimeout(t,20)}}function l(n){function e(t){var r=new RegExp(n.basePath,"gi"),i;return(i=r.exec(t))?i[0]:""}function o(t){var r=new RegExp(n.basePath,"gi"),i;return(i=r.exec(t))?t.substr(i[0].length):t}function u(){var n=r.getPath();r.pathChanged.notifySubscribers(n);f=n}var r=this,f="";n=i.utils.defaults({basePath:"^"},n||{});r.pathChanged=new t.subscribable;r.setPath=function(n){window.history.pushState({},"",e(window.location.pathname)+n);r.pathChanged.notifySubscribers(n)};r.getPath=function(){return o(window.location.pathname)};r.start=function(){i.utils.attachEvent(window,"popstate",u);u()};r.stop=function(){i.utils.detachEvent(window,"popstate",u)};r.revert=function(n){r.setPath(f);window.setTimeout(n,20)}}function e(){var n=this}function u(){var n=this;if(typeof jQuery=="undefined")throw"jQuery is required to use the DomTemplateProvider";}function f(n,t,r,u){var f=this,e,o={singleton:!1,templateSrc:null};e=arguments.length===1&&typeof n=="object"?i.utils.defaults(o,n):i.utils.defaults(o,{name:n,model:t,templateID:r,singleton:u});f.name=e.name;f.model=e.model;f.modelInstance=null;f.templateID=e.templateID;f.singleton=e.singleton;f.templateSrc=e.templateSrc}function a(n){function c(n,t,i){function o(){u++;u==2&&f(n)}var u=0,e=n.modelInstance||n.model||{};n!==f()&&f().unloadModel(!1,function(n){n||i()});typeof e=="function"&&(n.modelInstance=r.modelFactory.createModel(e,[r,t]));n.loadModel(t,function(t){if(t)o();else throw"The model for view '"+n.name+"' failed to load.";});r.templateProvider.loadTemplate(n.templateID,function(t){if(t.success)o();else throw"The template for view '"+n.name+"' failed to load with status: "+t.statusCode;})}function l(t){for(var u,e,f=0;f<r.routes.length;f++)if(u=r.routes[f].match(t,n.defaultRouteValues))break;return u==null?null:(e=i.utils.parseQueryString(t),i.utils.defaults(e,u))}function a(n){for(var t=0;t<r.views.length;t++)if(r.views[t].name===n)return r.views[t];return null}function o(t){var i=l(t),u=a(i[n.viewRouteKey]);if(u==null)throw"No view available.";c(u,i,function(){r.pathProvider.stop();r.pathProvider.revert(function(){r.pathProvider.start()})})}var r=this,h=new i.View("",{},"",null,!1),f,s,u;if(i.utils.defaults({defaultRoute:"/{view}/{id}",defaultRouteValues:{view:"index"},viewRouteKey:"view",views:[],pathProvider:"hash",templateProvider:"jQuery",createTemplates:!1,templateContainer:null},n),f=t.observable(h),r.routes=[new i.Route(n.defaultRoute,n.defaultRouteValues)],r.views=[],r.view=t.computed(function(){return f()}),n.views&&n.views.length)for(u=0;u<n.views.length;u++)n.views[u]instanceof i.View?r.views.push(n.views[u]):r.views.push(new i.View(n.views[u]));if(r.pathProvider=typeof n.pathProvider=="object"?n.pathProvider:n.pathProvider==="history"?new i.HistoryPathStringProvider(n.basePath):new i.HashPathStringProvider,r.templateProvider=typeof n.templateProvider=="object"?n.templateProvider:new i.jQueryTemplateProvider,r.modelFactory=new e,r.dispose=function(){r.pathProvider.stop();for(var n=0;n<r.views.length;n++)r.views[n].unloadModel(!0);s.dispose()},o(r.pathProvider.getPath()),s=r.pathProvider.pathChanged.subscribe(o),r.pathProvider.start(),n.createTemplates)for(u=0;u<r.views.length;u++)r.views[u].templateSrc&&r.templateProvider.getOrCreateTemplate(r.views[u].templateID,r.views[u].templateSrc,n.templateContainer)}var o=n.kr,i=n.kr=n.kr||{};i.noConflict=function(){return n.kr=o,i};i.utils=i.utils||{};i.utils.defaults=function(n,t){for(var i in n)t.hasOwnProperty(i)||typeof t[i]!="undefined"||typeof n[i]=="undefined"||(t[i]=n[i]);return t};i.utils.parseQueryString=function(n){var u={},f=(n||"").indexOf("?"),e=0,r,t,i;if(f>=0&&(n=n.slice(f+1)),typeof n!="undefined")for(r=n.split("&"),i=0;i<r.length;i++)t=r[i].split("="),t.length===2&&(u[t[0]]=t[1],e++);return e>0?u:null};i.utils.serializeQueryString=function(n){var i=[];for(var t in n)n.hasOwnProperty(t)&&i.push(t+"="+n[t]);return i.join("&")};i.utils.nowOrThen=function(n,t,i){typeof n=="boolean"?n?t():i():n!=null&&typeof n.done=="function"?n.done(t).fail(i):n!=null&&typeof n.then=="function"?n.then(t,i):i()};i.utils.attachEvent=function(n,t,i){if(n.addEventListener)n.addEventListener(t,i,!1);else if(n.attachEvent)n.attachEvent("on"+t,i);else throw"No event subscription method available.";};i.utils.detachEvent=function(n,t,i){if(n.removeEventListener)n.removeEventListener(t,i,!1);else if(n.detachEvent)n.detachEvent("on"+t,i);else throw"No event subscription method available.";};var s="\\{(\\w+)(:\\w+)?(\\??)\\}",h=/[\\w\\+\\.\\-]+'/i;r.parseKeyValue=function(n,t){switch(t){case"float":return parseFloat(n);case"int":return parseInt(n,10);case"hex":return parseInt(n,16);default:return n}};r.parseTemplate=function(n,t){var f=[],r,o=!1,i,c,u,l,e;for(n.indexOf(t)===0&&(n=n.slice(t.length)),r=n.split(t),i=0;i<r.length;i++)if(r[i]){for(u=[],l=new RegExp(s,"gi");c=l.exec(r[i]);)u.push(c);if(u.length===1){if(e=!1,f.push({value:r[i],parts:[{name:u[0][1],optional:e=u[0][3]==="?",type:"variable",dataType:(u[0][2]||":string").slice(1)}]}),o&&!e)throw"Invalid route template: A required segment cannot follow an optional one.";o=o||e}else if(u.length>1)throw"Invalid route template: Multi-part route segments are not implemented";else if(h.test(r[i]))f.push({value:r[i],parts:[{name:r[i],optional:!1,type:"literal",dataType:"string"}]});else if(r[i]==="*")f.push({value:r[i],parts:[{name:r[i],optional:!1,type:"wildcard",dataType:"string"}]});else throw"Invalid route template: The segment value '"+r[i]+"' is invalid.";}return f};r.prototype.match=function(n,t){var o,f,e,s={},h,u,i,c;if(n==null)throw"A value for path must be specified.";for(n.indexOf(this.options.pathSeperator)===0&&(n=n.slice(this.options.pathSeperator.length)),h=-1,(h=n.indexOf("?"))>=0&&(n=n.slice(0,h)),o=n.split(this.options.pathSeperator),u=0;u<o.length;u++)if(f=o[u],e=this.elements.length>u?this.elements[u]:null,e==null){if(f.length>0)return null}else if(e.parts.length===1){if(i=e.parts[0],i.type==="literal"){if(i.name!==f)return null}else if(i.type!=="wildcard")if(i.type==="variable"&&f.length>0)s[i.name]=r.parseKeyValue(f,i.dataType);else if(i.type==="variable"){if(t&&(c=t[i.name]))s[i.name]=c;else if(!i.optional)return null}else return null}else throw"Multi-part route segments are not implemented";return s};r.prototype.resolve=function(n,t){var u=[],e,f,o,i,r;for(t!=null&&(t[0]===this.options.pathSeperator&&(t=t.slice(1)),e=t.split(this.options.pathSeperator)),r=0;r<this.elements.length;r++)if(o=this.elements[r],f=e?e[r]:null,o.parts.length===1){if(i=o.parts[0],i.type==="wildcard")if(f&&f.length>0)u.push(f);else return null;else if(i.type==="literal")u.push(i.name);else if(i.type==="variable")if(n.hasOwnProperty(i.name))u.push(n[i.name]);else if(!i.optional)return null}else throw"Multi-part route segments are not supported.";return u.join(this.options.pathSeperator)};i.Route=r;e.prototype.createModel=function(n,t){if(typeof n=="function"){function i(){return n.apply(this,t)}return i.prototype=n.prototype,new i}throw"constructor must be a valid constructor function.";};u.prototype.loadTemplate=function(n,t){var r=window.document.getElementById(n);if(!r)throw"There is no element with id "+n+".";if(r.tagName.toLowerCase()!=="script")throw"The element with id "+n+" must be a <script> tag in order to use it as a template.";var u=r.getAttribute("data-src"),f=r.getAttribute("data-loaded"),i={success:!1,statusCode:0,template:r};u&&!f?jQuery.get(u).done(function(n,u,f){r.text=n;r.setAttribute("data-loaded","true");i.success=!0;i.statusCode=f.status;t(i)}).fail(function(n){i.success=!1;i.statusCode=n.status;t(i)}):(i.success=!0,i.statusCode=203,t(i))};u.prototype.unloadTemplate=function(n){if(typeof n=="string"&&(n=window.document.getElementById(n)),!(n instanceof HTMLScriptElement))throw"The 'template' parameter must be an element ID or an HTMLScriptElement";n.text=""};u.prototype.getOrCreateTemplate=function(n,t,i){var r=window.document.getElementById(n);return(i=i||window.document.body,r)?r:(r=window.document.createElement("script"),r.type="text/html",r.id=n,r.setAttribute("data-src",t),i.appendChild(r),r)};i.HashPathStringProvider=c;i.HistoryPathStringProvider=l;typeof jQuery!="undefined"&&(i.jQueryTemplateProvider=u);f.prototype.loadModel=function(n,t){var r=this;typeof this.modelInstance=="object"&&typeof this.modelInstance.load=="function"?i.utils.nowOrThen(this.modelInstance.load(n),function(){t(!0)},function(){t(!1)}):t(!0)};f.prototype.unloadModel=function(n,t){function u(i){model.singleton&&n||i?(typeof r.modelInstance.dispose=="function"&&r.modelInstance.dispose(),r.modelInstance=null,t(!0)):t(!1)}var r=this;this.modelInstance!=null&&typeof this.modelInstance.unload=="function"?i.utils.nowOrThen(this.modelInstance.unload(),function(){u(!0)},function(){u(!1)}):n?(r.modelInstance=null,t(!0)):t(!0)};i.View=f;i.ViewRouter=a})(window,ko);
/*
//# sourceMappingURL=knockroute.min.js.map
*/