/**
 * knockroute - Router & lazy template loader for Knockout
 * Copyright 2016 Justin R. Buchanan 
 * @version v1.0.1
 * @link https://github.com/jusbuc2k/knockroute
 * @license MIT
 */
!function(e){"function"==typeof define&&define.amd?define(["exports","require","knockout","jquery"],e):e(null,null,window.ko,window.jQuery)}(function(e,t,n,r){"use strict";function a(){n.bindingHandlers.routeTemplate=V,n.route=I}function o(e){return e.replace(E,"")}function i(e,t){return"true"===o((e.getAttribute(t)||"").toLowerCase())}function s(e){return"object"==typeof e&&"number"==typeof e.length}function l(e){return null==e?null:":"===e[0]?C.dataType(e.slice(1)):"="===e[0]?C.equals(e.slice(1)):null}function u(e,t){return t[e.areaRouteKey]?e.router.getView(t[e.viewRouteKey],t[e.areaRouteKey]):e.router.getView(t[e.viewRouteKey])}function p(e){this.isDisposed=!1,this.disposalCallback=e}function c(e,t){var n={pathSeperator:"/"};t=this.options=I.utils.defaults(n,t||{}),this.routeTemplate=e,this.segments=c.parseTemplate(e,t.pathSeperator)}function d(e){function t(){var e=a.getPath();"string"==typeof e&&r(e),a.pathChanged.notifySubscribers(e)}function r(t){o.length>=e.maxHistoryEntries&&o.splice(0,1+(e.maxHistoryEntries-o.length)),o.push(t)}var a=this,o=[];e=I.utils.defaults({maxHistoryEntries:100},e||{}),a.pathChanged=new n.subscribable,a.setPath=function(e){e?window.location.hash=a.decorate(e):window.location.hash=""},a.getPath=function(){return window.location.hash.slice(1)},a.decorate=function(e){return 0===e.indexOf("#/")?e:"/"===e[0]?"#"+e:"#"===e[0]?"#/"+e.slice(1):"#/"+e},a.start=function(e){I.utils.attachEvent(window,"hashchange",t),e!==!1&&t()},a.stop=function(){I.utils.detachEvent(window,"hashchange",t)},a.peekBack=function(){return o.length>=2?o[o.length-2]:void 0},a.back=function(e){return o.length>1?(o.pop(),a.setPath(o.pop()),"function"==typeof e&&window.setTimeout(e,1),!0):!1}}function f(e){function t(t){var n,r=new RegExp(e.basePath,"gi");return(n=r.exec(t))?n[0]:""}function r(t){var n,r=new RegExp(e.basePath,"gi");return(n=r.exec(t))?t.substr(n[0].length):t}function a(){var e=i.getPath();"string"==typeof e&&o(e),i.pathChanged.notifySubscribers(e)}function o(t){s.length>=e.maxHistoryEntries&&s.splice(0,1+(e.maxHistoryEntries-s.length)),s.push(t)}var i=this,s=[],l={basePath:"^",maxHistoryEntries:100};e=I.utils.defaults(l,e||{}),i.pathChanged=new n.subscribable,i.setPath=function(e){window.history.pushState({},"",t(window.location.pathname)+e),i.pathChanged.notifySubscribers(e)},i.getPath=function(){return r(window.location.pathname)},i.decorate=function(e){return e},i.start=function(e){I.utils.attachEvent(window,"popstate",a),e!==!1&&a()},i.stop=function(){I.utils.detachEvent(window,"popstate",a)},i.back=function(e){return s.length>=2?(s.pop(),i.setPath(s.pop()),"function"==typeof e&&window.setTimeout(e,1),!0):!1}}function h(){}function m(){}function v(e){var t={createTemplates:!0,useTags:!0,tagName:"script",templateContainer:null,cache:!0,cacheNodes:!0};if(this.options=I.utils.defaults(t,e||{}),this.templateCache={},"undefined"==typeof r)throw"jQuery is required to use the DomTemplateProvider"}function w(){}function g(e){var t=this,r={name:null,views:[]};n.utils.extend(t,I.utils.defaults(r,e||{}))}function y(e){var t=this,r={name:null,area:null,model:null,modelInstance:null,templateID:null,activeTemplateID:null,templateSrc:null,templatePersist:!1,singleton:!1,content:null,scope:null,resetScroll:!0,onModelCreating:null,onModelUnloading:null,handler:null};n.utils.extend(t,I.utils.defaults(r,e||{})),t.activeTemplateID=n.observable(t.activeTemplateID)}function b(){this._channels={},this._subs=[]}function T(e){function t(e){return{path:e,isCancelled:!1,cancel:function(){this.isCancelled||(this.isCancelled=!0,x.pathProvider.stop(),x.pathProvider.back(function(){x.pathProvider.start(!1)}))},isPersistModelSet:!1,persistModel:function(){this.isPersistModelSet=!0},isPreventDisposeSet:!1,preventDispose:function(){this.isPreventDisposeSet=!0}}}function r(t,n,r){var a,o,i,s=t.templateID,l=!0,u={cancel:function(){throw new Error("Cancel Not Implemented")},setTemplate:function(e){if(!l)throw"Template cannot be set at this time.";s=e}};return a=t.modelInstance&&"function"==typeof t.modelInstance[n]?P.resolve(t.modelInstance[n].apply(t.modelInstance,[r,u])):P.resolve(null),l=!1,s!==t.templateID||n===e.loadMethodName?(o=x.getTemplate(s,t),i=p(o),P.all([a,i])):a}function a(e,t){x.onUnload.notifySubscribers({context:this,routeValues:t.routeValues,navigation:t}),t.isCancelled||("function"==typeof e.onModelUnloading&&e.onModelUnloading.apply(e,[t.routeValues,e.modelInstance,t]),t.isCancelled||null!=e.modelInstance&&"function"==typeof e.modelInstance.unload&&e.modelInstance.unload.apply(e.modelInstance,[t.routeValues,t])===!1&&t.cancel())}function o(e){e.singleton!==!0&&null!=e.modelInstance&&"function"==typeof e.modelInstance.dispose&&e.modelInstance.dispose.apply(e.modelInstance)}function i(e){var t;for(t=0;t<M.length;t++)M[t]!==e&&null!=M[t].modelInstance&&null!=M[t].scope&&M[t].scope!==e.scope&&o(M[t],e)}function l(t,n,s){var l,u=[],p=H(),c=!1;return F&&F.abort("abort"),t===p?void r(t,e.updateMethodName,n)["catch"](function(t){m("Error",e.errorTemplateID,t,n)}):(a(p,s),void(s.isCancelled||(F=I.utils.abortable(function(){H(t),F=null,t.resetScroll!==!1&&x.scrollProvider.resetScroll(),x.onLoaded.notifySubscribers({routeValues:n,navigation:s,context:this})}),"function"==typeof t.onModelCreating&&t.onModelCreating.apply(t,[n,s]),l=t.modelInstance||t.model||{},x.onLoading.notifySubscribers({routeValues:n,navigation:s,context:this}),("function"==typeof l||"string"==typeof l)&&(l=x.modelFactory.createModel(l,[x,n])),P.resolve(l).then(function(a){t.modelInstance=a;try{s.isPreventDisposeSet||(o(p),i(t)),p.singleton||s.isPersistModelSet||(p.modelInstance=null),p.activeTemplateID()&&p.activeTemplateID()!==t.templateID&&("function"==typeof p.disposeTemplate?p.disposeTemplate():x.templateProvider.unloadTemplate(p.activeTemplateID())),u.push(r(t,e.loadMethodName,n).then(function(){return r(t,e.updateMethodName,n)}))}catch(l){return m("Error",e.errorTemplateID,l,n),P.reject(l)}return P.all(u).then(F)["catch"](function(t){F=null,"abort"===t||c||(c=!0,m("Error",e.errorTemplateID,t,n))})}))))}function p(e){var t,r;return"string"==typeof e?(t=x.getTemplate(e),r=e):(t=e,r=e.templateID),x.templateProvider.loadTemplate(t).then(function(t){t.templateNodes&&(e.templateNodes=t.templateNodes),n.isWriteableObservable(e.activeTemplateID)&&e.activeTemplateID(r)})}function c(t,n){var r,a,o;for(r=0;r<n.length;r++)if(o=n[r].route.match(t,n[r].defaults)){if(a=e.viewResolver.call(null,{areaRouteKey:e.areaRouteKey,viewRouteKey:e.viewRouteKey,router:x},o),null==a)continue;return{view:a,routeValues:o,route:n[r]}}return null}function d(e,t,n){var r,a,o,i;for(r=n.length-1;r>=0;r--)if(a=n[r].route.resolve(e,t))return o=n[r].route,i=n[r].defaults,{route:o,defaults:i,path:a};return null}function f(e){var t;return t=c(e,R),null==t&&(t=c(e,N)),null==t||null==t.routeValues||null==t.view?null:{view:t.view,route:t.route,routeValues:n.utils.extend(t.routeValues,I.utils.parseQueryString(e))}}function m(t,n,r,a){var o,i={routeValues:a,context:this,error:r,errorHandled:!1},s=new I.View({name:t,modelInstance:{name:t,routeValues:a,error:r},content:null});x.onLoadError.notifySubscribers(i),!i.errorHandled&&n?(o=x.getTemplate(n,{templateID:n}),"function"==typeof e.errorModel&&(s.modelInstance=new e.errorModel(a,r)),p(o).then(function(){s.activeTemplateID(o.templateID),H(s)},function(e){s.content="Failed to load the error template.",H(s)})):i.errorHandled||(s.content="An error occurred while loading the view.",H(s))}function v(n){var r=f(n),a=t(n);return null==r?a.routeValues=null:(a.routeValues=r.routeValues,a.view=r.view),null==r?void m("NotFound",e.notFoundTemplateID,"Path not found"):void l(r.view,r.routeValues,a)}function g(e){T&&(T.dispose(),T=null),x.pathProvider&&x.pathProvider.stop(),x.pathProvider=e,T=x.pathProvider.pathChanged.subscribe(v),C&&x.pathProvider.start()}function y(){C||(H(E),x.pathProvider.start(),C=!0)}function b(e){var t,n;if(t=e instanceof I.View?e:new I.View(e),null==t.area)M.push(t);else{if(n=x.getArea(t.area),null==n)throw"Invalid area name on view";n.addView(t)}}var T,E,x=this,S={routes:[{template:"{view}/{id?}",defaults:{view:"home"}}],areas:[],views:[],templates:[],viewRouteKey:"view",areaRouteKey:"area",loadMethodName:"load",updateMethodName:"update",pathProvider:"hash",templateProvider:"default",modelFactory:"default",scrollProvider:"window",defaultContent:"Loading...",defaultTemplateID:"",defaultTemplateNodes:null,errorTemplateID:"",notFoundTemplateID:"",viewResolver:u},C=!1,V=[],N=[],R=[],A=[],M=[],F=null;e=I.utils.defaults(S,e||{}),E=new I.View({name:null,templateID:e.defaultTemplateID,templateNodes:e.defaultTemplateNodes,content:e.defaultContent});var H=n.observable(E);x.pathProvider=null,g(new I.HashPathStringProvider),x.templateProvider=new I.DefaultTemplateProvider,x.modelFactory=new h,x.scrollProvider=new w,x.bus=new I.Bus,x.clearTemplates=function(){I.utils.clearArray(V)},x.clearRoutes=function(){I.utils.clearArray(N),I.utils.clearArray(R)},x.clearViews=function(){I.utils.clearArray(A),I.utils.clearArray(R),I.utils.clearArray(M)},x.addTemplates=function(e){e&&e.forEach&&e.forEach(function(e){V.push(e)})},x.addAreas=function(e){if(!e||!e.forEach)throw new TypeError("newAreas must be an array.");e.forEach(function(e){A.push(new I.Area(e)),s(e.routes)?e.routes.forEach(function(t){R.push({route:new I.Route("{area="+e.name+"}/"+t.template),defaults:n.utils.extend({},t.defaults)})}):R.push({route:new I.Route("{area="+e.name+"}/"+N[0].route.routeTemplate),defaults:n.utils.extend({},N[0].defaults)})})},x.addViews=function(e){if(!e||!e.forEach)throw new TypeError("addedViews must be an array.");e.forEach(function(e){b(e)})},x.insertRoutes=function(e){var t;if(!e||!e.length)throw new TypeError("insertedRoutes must be an array.");for(t=e.length-1;t>=0;t--)N.splice(0,0,{route:new I.Route(e[t].template),defaults:e[t].defaults})},x.addRoutes=function(e){if(!e||!e.forEach)throw new TypeError("addedRoutes must be an array.");e.forEach(function(e){N.push({route:new I.Route(e.template),defaults:e.defaults})})},x.getArea=function(e){return n.utils.arrayFirst(A,function(t){return t.name===e})},x.getView=function(e,t){var r;return 1===arguments.length?n.utils.arrayFirst(M,function(t){return t.name===e}):2===arguments.length?(r=x.getArea(t),null==r?null:r.getView(e)):null},x.getTemplate=function(e,t){var r=n.utils.arrayFirst(V,function(t){return t.templateID===e});return r?r:t},x.setOptions=function(t){if(null==t)throw new TypeError("newOptions must be an object.");n.utils.extend(e,t),s(t.templates)&&(x.clearTemplates(),x.addTemplates(t.templates)),s(t.routes)&&(x.clearRoutes(),x.addRoutes(t.routes)),s(t.areas)&&s(t.views)?(x.clearViews(),x.addAreas(t.areas),x.addViews(t.views)):s(t.areas)?(x.clearViews(),x.addAreas(t.areas)):s(t.views)&&(x.clearViews(),x.addViews(t.views)),"object"==typeof t.templateProvider?x.templateProvider=t.templateProvider:"ajax"===t.templateProvider&&(x.templateProvider=new I.AjaxTemplateProvider),"object"==typeof t.pathProvider?g(t.pathProvider):"history"===t.pathProvider&&g(new I.HistoryPathStringProvider(t.basePath)),"object"==typeof t.scrollProvider?x.scrollProvider=t.scrollProvider:"window"===t.scrollProvider&&(x.scrollProvider=new I.WindowScrollProvider)},x.resolve=function(e,t){var n,r,a="",o={},i=!1;if(t||(n=x.pathProvider.getPath()),r=d(e,n,R),null==r&&(r=d(e,n,N)),null==r)throw"No matching route for given path";a+=r.route.resolve(e,n,r.defaults);for(var s in e)e.hasOwnProperty(s)&&!r.route.hasKey(s)&&void 0===o[s]&&(o[s]=e[s],i=!0);return i&&(a+=D+I.utils.serializeQueryString(o)),this.pathProvider.decorate(a)},x.navigate=function(e,t){var n;if(n="string"==typeof e&&1===arguments.length?e:x.resolve(e,t),null==n)throw"No matching route or path exists.";x.pathProvider.setPath(n)},x.navigateBack=function(){return"function"==typeof x.pathProvider.back?new P(function(e,t){x.pathProvider.back(e)}):new P.resolve(null)},x.setView=function(e,n,r){var a;e instanceof I.View||(e=new I.View(e)),e!=H()&&(n=n||{},"string"==typeof r?(this.pathProvider.stop(),this.pathProvider.setPath(r),this.pathProvider.start(!1)):r=this.pathProvider.getPath(),a=t(r),l(e,n,a))},x.setTemplate=function(e){H().activeTemplateID(e)},x.dispose=function(){x.pathProvider.stop();var e=!1;T&&(T.dispose(),T=null);for(var t=0;t<M.length;t++)o(M[t]),M[t]===H()&&(e=!0);e||(a(H()),o(H())),H(null)},x.init=y,x.view=n.computed(function(){return H()}),x.onLoading=new n.subscribable,x.onLoaded=new n.subscribable,x.onUnload=new n.subscribable,x.onLoadError=new n.subscribable,this.setOptions(e)}var P=window.Promise||window.ES6Promise.Promise,I=e||{},E=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,x="\\{(\\w+)([=:]\\w+)?(\\??)\\}",S=/^[\w\+\.\-\~]+$/i,D="?",C={equals:function(e){return function(t){return e===t}},dataType:function(e){var t=/.*/;return"float"===e?t=/^[-+]?\d*\.?\d*$/i:"int"===e?t=/^[-+]?\d*$/i:"hex"===e&&(t=/^[a-fA-F0-9]*$/i),function(e){return t.test(e)}}};I.defaultViewResolver=u,I.utils=I.utils||{},I.utils.clearArray=function(e){for(;e.length>0;)e.pop()},I.utils.defaults=function(e,t){for(var n in e)t.hasOwnProperty(n)||"undefined"!=typeof t[n]||"undefined"==typeof e[n]||(t[n]=e[n]);return t},I.utils.parseQueryString=function(e){var t={},n=(e||"").indexOf("?"),r=0;if(n>=0&&(e=e.slice(n+1)),"undefined"!=typeof e)for(var a,o=e.split("&"),i=0;i<o.length;i++)a=o[i].split("="),2===a.length&&(t[a[0]]=decodeURIComponent(a[1]),r++);return r>0?t:null},I.utils.serializeQueryString=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+"="+e[n]);return t.join("&")},I.utils.attachEvent=function(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else{if(!e.attachEvent)throw"No event subscription method available.";e.attachEvent("on"+t,n)}},I.utils.detachEvent=function(e,t,n){if(e.removeEventListener)e.removeEventListener(t,n,!1);else{if(!e.detachEvent)throw"No event subscription method available.";e.detachEvent("on"+t,n)}},I.utils.abortable=function(e){function t(){return n?P.reject(n):P.resolve(e.apply(this,arguments))}var n=null;return t.abort=function(e){n=e},t},I.utils.setTextContent=function(e,t){e&&"undefined"!=typeof e.innerHTML?e.innerHTML=t:e&&"undefined"!=typeof e.textContent?e.textContent=t:e&&"undefined"!=typeof e.innerText&&(e.innerText=t)},p.prototype.dispose=function(){this.isDisposed||(this.disposalCallback(),this.isDisposed=!0)},c.parseSegmentValue=function(e,t){switch(e=decodeURIComponent(e),t){case"float":return parseFloat(e);case"int":return parseInt(e,10);case"hex":return parseInt(e,16);default:return e}},c.parseTemplate=function(e,t){var n,r=[],a=!1;0===e.indexOf(t)&&(e=e.slice(t.length)),n=e.split(t);for(var o=0;o<n.length;o++)if(n[o]){for(var i,s=[],u=new RegExp(x,"gi");i=u.exec(n[o]);)s.push(i);if(1===s.length){var p=!1,c=s[0][2]&&":"===s[0][2][0]?s[0][2].slice(1):"string";if("params"===c?(r.push({value:n[o],parts:[{name:s[0][1],optional:!0,type:"params",dataType:"string"}]}),p=!0):r.push({value:n[o],parts:[{name:s[0][1],optional:p="?"===s[0][3],type:"parameter",constraint:l(s[0][2]),dataType:c}]}),a&&!p)throw"Invalid route template: A required segment cannot follow an optional one.";a=a||p}else{if(s.length>1)throw"Invalid route template: Multi-part route segments are not implemented";if(S.test(n[o]))r.push({value:n[o],parts:[{name:n[o],optional:!1,type:"literal"}]});else{if("*"!==n[o])throw"Invalid route template: The segment value '"+n[o]+"' is invalid.";r.push({value:n[o],parts:[{name:n[o],optional:!1,type:"wildcard",dataType:"string"}]})}}}return r},c.prototype.match=function(e,t){var n,r,a,o={};if(null==e)throw"A value for path must be specified.";0===e.indexOf(this.options.pathSeperator)&&(e=e.slice(this.options.pathSeperator.length));var i=-1;(i=e.indexOf("?"))>=0&&(e=e.slice(0,i)),n=e.split(this.options.pathSeperator);for(var s=0;s<n.length;s++)if(r=n[s],a=this.segments.length>s?this.segments[s]:null,null==a){if(r.length>0)return null}else{if(1!==a.parts.length)throw"Multi-part route segments are not implemented";var l=a.parts[0];if("literal"===l.type){if(l.name!==r)return null}else if("wildcard"===l.type);else if("parameter"===l.type&&r.length>0){if(null!=l.constraint&&!l.constraint(r))return null;o[l.name]=c.parseSegmentValue(r,l.dataType)}else{if("parameter"!==l.type){if("params"===l.type&&this.segments.length-1==s){o[l.name]=n.slice(s).map(decodeURIComponent);break}return null}var u;if(t&&(u=t[l.name]))o[l.name]=u;else if(!l.optional)return null}}for(var s=n.length;s<this.segments.length;s++){if(a=this.segments[s],a.parts.length>1)return null;var l=a.parts[0];if("literal"===l.type)return null;var u;if(t&&(u=t[l.name])||"wildcard"===l.type)o[l.name]=u;else if(!l.optional)return null}if(null!=t)for(var p in t)t.hasOwnProperty(p)&&!o.hasOwnProperty(p)&&(o[p]=t[p]);return o},c.prototype.resolve=function(e,t,r){var a,o,i,s,l=[],u=Number.MAX_VALUE,p=!1,c=-1;"string"==typeof t&&t.length>0&&(t[0]===this.options.pathSeperator&&(t=t.slice(1)),(c=t.indexOf("?"))>=0&&(t=t.slice(0,c)),a=t.split(this.options.pathSeperator));for(var d=0;d<this.segments.length;d++){if(i=this.segments[d],o=a&&a[d]?decodeURI(a[d]):null,1!==i.parts.length)throw"Multi-part route segments are not supported.";if(s=i.parts[0],"wildcard"===s.type){if(!(o&&o.length>0))return null;l.push(o)}else if("literal"===s.type)l.push(s.name);else if("parameter"===s.type){if(e.hasOwnProperty(s.name)){if(p=!0,null!=s.constraint&&!s.constraint(e[s.name]))return null;l.push(e[s.name])}else if(!p&&o&&o.length>0){if(null!=s.constraint&&!s.constraint(o))return null;l.push(o)}else if("object"==typeof r&&r.hasOwnProperty(s.name))l.push(r[s.name]);else if(!s.optional)return null}else if("params"===s.type&&d==this.segments.length-1){var f=e[s.name];f&&(f=f.map(encodeURIComponent).join(this.options.pathSeperator),f.length&&(u=l.length,l.push(f)))}}var h=0;return n.utils.arrayForEach(this.segments,function(e){e.parts[0].optional||h++}),l.length<h?null:l.map(function(e,t){return u>t?encodeURIComponent(e):e}).join(this.options.pathSeperator)},c.prototype.hasKey=function(e){for(var t=0;t<this.segments.length;t++)for(var n=0;n<this.segments[t].parts.length;n++)if(this.segments[t].parts[n].name===e)return!0;return!1},I.Route=c,I.HashPathStringProvider=d,I.HistoryPathStringProvider=f,h.prototype.createModel=function(e,t){function n(){return e.apply(this,t)}if("function"==typeof e)return n.prototype=e.prototype,new n;throw"constructor must be a valid constructor function."},m.prototype.loadTemplate=function(e){var t=window.document.getElementById(e.templateID);if(!t)throw"There is no element with id "+e.templateID+".";if("script"!==t.tagName.toLowerCase())throw"The element with id "+e.templateID+" must be a <script> tag in order to use it as a template.";return P.resolve({success:!0,statusCode:203,template:t})},m.prototype.unloadTemplate=function(e){},I.DefaultTemplateProvider=m,v.prototype.loadTemplateTag=function(e){var t=window.document.getElementById(e.templateID),n=this.options.templateContainer||window.document.body,a=this;if(this.options.createTemplates&&!t&&e.templateSrc)t=window.document.createElement(this.options.tagName),t.type="text/html",t.id=e.templateID,this.options.cache?t.setAttribute("data-src",e.templateSrc):t.setAttribute("data-src",e.templateSrc+"?v="+(new Date).getTime().toString()),e.templatePersist&&t.setAttribute("data-persist","true"),n.appendChild(t);else if(!t)throw"There is no template defined with id '"+e.templateID+"'";if(t.tagName.toLowerCase()!==this.options.tagName)throw"The element with id "+e.templateID+" must be a <"+this.options.tagName+"> tag in order to use it as a template.";var o=e.templateSrc||t.getAttribute("data-src"),s=i(t,"data-loaded"),l={success:!1,statusCode:0,template:t};return new P(function(e,n){o&&!s?(a.options.cache||(o+="?v="+(new Date).getTime().toString()),r.get(o).done(function(n,r,a){t.text=n,t.setAttribute("data-loaded","true"),l.success=!0,l.statusCode=a.status,l.statusText=a.statusText,e(l)}).fail(function(e,t,r){l.success=!1,l.statusCode=e.status,l.statusText=e.statusText,n(l)})):(l.success=!0,l.statusCode=203,e(l))})},v.prototype.loadTemplateNodes=function(e){var t=this,a={success:!1,statusCode:0};if(null==e.templateID)throw new Error("The templateID must be provided for the given view.");return new P(function(o,i){var s,l,u=t.templateCache[e.templateID];if(u)a.templateNodes=u.nodes,a.success=!0,a.statusCode=203,o(a);else if(l=window.document.getElementById(e.templateID))a.templateNodes=n.utils.parseHtmlFragment(l.text),a.success=!0,a.statusCode=203,o(a);else{if(null==e.templateSrc)throw new Error("The templateSrc must be provided for the given view.");s=e.templateSrc,t.options.cache||(s+="?v="+(new Date).getTime().toString()),r.get(s).done(function(r,i,s){var l=$(r);"TEMPLATE"===l.prop("tagName")?l[0].content?a.templateNodes=l[0].content.childNodes:a.templateNodes=n.utils.parseHtmlFragment(l.html()):"SCRIPT"===l.prop("tagName")?a.templateNodes=n.utils.parseHtmlFragment(l[0].text):a.templateNodes=l.toArray(),t.options.cacheNodes&&e.templatePersist&&(t.templateCache[e.templateID]={persist:e.templatePersist,nodes:a.templateNodes}),a.success=!0,a.statusCode=s.status,a.statusText=s.statusText,o(a)}).fail(function(e,t,n){a.success=!1,a.statusCode=e.status,a.statusText=e.statusText,i(a)})}})},v.prototype.loadTemplate=function(e){return this.options.useTags?this.loadTemplateTag(e):this.loadTemplateNodes(e)},v.prototype.unloadTemplate=function(e){if(this.options.useTags){if("string"==typeof e&&(e=window.document.getElementById(e)),!(e instanceof HTMLScriptElement))throw"The 'template' parameter must be an element ID or an HTMLScriptElement";if(i(e,"data-persist")||null==e.getAttribute("data-src"))return;e.setAttribute("data-loaded","false"),e.text=""}},"undefined"!=typeof r&&(I.AjaxTemplateProvider=v),w.prototype.resetScroll=function(){window.scrollTo(0,0)},I.WindowScrollProvider=w,g.prototype.getView=function(e){return n.utils.arrayFirst(this.views,function(t){return t.name===e})},g.prototype.addView=function(e){this.views.push(e)},g.prototype.clearViews=function(){I.utils.clearArray(this.views)},I.Area=g,I.View=y,b.prototype.publish=function(e,t,n){this._channels[e]&&this._channels[e].notifySubscribers(n,t)},b.prototype.subscribe=function(e,t,r){var a=this;this._channels[e]=this._channels[e]||new n.subscribable;var o=a._channels[e].subscribe(r,a,t),i=new p(function(){o.dispose(),n.utils.arrayRemoveItem(a._subs,i),a._channels[e]&&a._channels[e].getSubscriptionsCount()<=0&&(a._channels[e]=null)});return this._subs.push(i),i},b.prototype.dispose=function(){for(;this._subs.length>0;)this._subs.pop().dispose()},b["default"]=new b,I.Bus=b,I.ViewRouter=T;var V={init:function(e,t,r,a,o){var i=n.bindingHandlers.template.init(e,function(){return""}),s=n.utils.unwrapObservable(t());return n.computed(function(){var t,i=s.view(),l=function(){return t};if(!i)return void I.utils.setTextContent(e,"<h2>Error</h2><p>Something went wrong when trying to display content.</p>");if(i.content&&i.modelInstance&&i.modelInstance.error)return void I.utils.setTextContent(e,"<h2>Error</h2><p>"+i.content+"</p><p>"+(i.modelInstance.error.stack?i.modelInstance.error.stack:"")+"</p>");if(i.content)return void I.utils.setTextContent(e,i.content);if(t={data:i.modelInstance},i.templateNodes?t.nodes=i.templateNodes:t.name=n.unwrap(i.activeTemplateID)||i.templateID,!t.data||!t.name&&!t.nodes)throw"Failed to load view";n.bindingHandlers.template.init(e,l),n.bindingHandlers.template.update(e,l,r,a,o)},this,{disposeWhenNodeIsRemoved:e}).extend({rateLimit:10}),s.init(),i},update:function(e,t,n,r,a){}};a()});