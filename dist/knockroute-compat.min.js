/**
 * knockroute - Router & lazy template loader for Knockout
 * Copyright 2016 Justin R. Buchanan 
 * @version v0.9.16-alpha1
 * @link https://github.com/jusbuc2k/knockroute
 * @license MIT
 */
// Includes Array map polyfill from http://es5.github.io/#x15.4.4.19 
// Includes es6-promise polyfill from https://github.com/jakearchibald/es6-promise 
(function(){function e(e,t){D[E]=e,D[E+1]=t,E+=2,2===E&&P()}function t(e){return"function"==typeof e}function n(){return function(){process.nextTick(a)}}function r(){var e=0,t=new S(a),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function o(){var e=new MessageChannel;return e.port1.onmessage=a,function(){e.port2.postMessage(0)}}function i(){return function(){setTimeout(a,1)}}function a(){for(var e=0;E>e;e+=2)D[e](D[e+1]),D[e]=void 0,D[e+1]=void 0;E=0}function s(){}function l(e,t,n,r){try{e.call(t,n,r)}catch(o){return o}}function u(t,n,r){e(function(e){var t=!1,o=l(r,n,function(r){t||(t=!0,n!==r?p(e,r):f(e,r))},function(n){t||(t=!0,h(e,n))});!t&&o&&(t=!0,h(e,o))},t)}function c(e,t){1===t.a?f(e,t.b):2===e.a?h(e,t.b):m(t,void 0,function(t){p(e,t)},function(t){h(e,t)})}function p(e,n){if(e===n)h(e,new TypeError("You cannot resolve a promise with itself"));else if("function"==typeof n||"object"==typeof n&&null!==n)if(n.constructor===e.constructor)c(e,n);else{var r;try{r=n.then}catch(o){C.error=o,r=C}r===C?h(e,C.error):void 0===r?f(e,n):t(r)?u(e,n,r):f(e,n)}else f(e,n)}function d(e){e.f&&e.f(e.b),v(e)}function f(t,n){void 0===t.a&&(t.b=n,t.a=1,0!==t.e.length&&e(v,t))}function h(t,n){void 0===t.a&&(t.a=2,t.b=n,e(d,t))}function m(t,n,r,o){var i=t.e,a=i.length;t.f=null,i[a]=n,i[a+1]=r,i[a+2]=o,0===a&&t.a&&e(v,t)}function v(e){var t=e.e,n=e.a;if(0!==t.length){for(var r,o,i=e.b,a=0;a<t.length;a+=3)r=t[a],o=t[a+n],r?g(n,r,o,i):o(i);e.e.length=0}}function w(){this.error=null}function g(e,n,r,o){var i,a,s,l,u=t(r);if(u){try{i=r(o)}catch(c){A.error=c,i=A}if(i===A?(l=!0,a=i.error,i=null):s=!0,n===i)return void h(n,new TypeError("A promises callback cannot return that same promise."))}else i=o,s=!0;void 0===n.a&&(u&&s?p(n,i):l?h(n,a):1===e?f(n,i):2===e&&h(n,i))}function y(e,t){try{t(function(t){p(e,t)},function(t){h(e,t)})}catch(n){h(e,n)}}function b(e,t,n,r){this.n=e,this.c=new e(s,r),this.i=n,this.o(t)?(this.m=t,this.d=this.length=t.length,this.l(),0===this.length?f(this.c,this.b):(this.length=this.length||0,this.k(),0===this.d&&f(this.c,this.b))):h(this.c,this.p())}function T(e){if(V++,this.b=this.a=void 0,this.e=[],s!==e){if(!t(e))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof T))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");y(this,e)}}var P,I=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},E=0,x="undefined"!=typeof window?window:{},S=x.MutationObserver||x.WebKitMutationObserver,x="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,D=Array(1e3);P="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?n():S?r():x?o():i();var C=new w,A=new w;b.prototype.o=function(e){return I(e)},b.prototype.p=function(){return Error("Array Methods must be provided an Array")},b.prototype.l=function(){this.b=Array(this.length)},b.prototype.k=function(){for(var e=this.length,t=this.c,n=this.m,r=0;void 0===t.a&&e>r;r++)this.j(n[r],r)},b.prototype.j=function(e,t){var n=this.n;"object"==typeof e&&null!==e?e.constructor===n&&void 0!==e.a?(e.f=null,this.g(e.a,t,e.b)):this.q(n.resolve(e),t):(this.d--,this.b[t]=this.h(e))},b.prototype.g=function(e,t,n){var r=this.c;void 0===r.a&&(this.d--,this.i&&2===e?h(r,n):this.b[t]=this.h(n)),0===this.d&&f(r,this.b)},b.prototype.h=function(e){return e},b.prototype.q=function(e,t){var n=this;m(e,void 0,function(e){n.g(1,t,e)},function(e){n.g(2,t,e)})};var V=0;T.all=function(e,t){return new b(this,e,!0,t).c},T.race=function(e,t){function n(e){p(o,e)}function r(e){h(o,e)}var o=new this(s,t);if(!I(e))return h(o,new TypeError("You must pass an array to race.")),o;for(var i=e.length,a=0;void 0===o.a&&i>a;a++)m(this.resolve(e[a]),void 0,n,r);return o},T.resolve=function(e,t){if(e&&"object"==typeof e&&e.constructor===this)return e;var n=new this(s,t);return p(n,e),n},T.reject=function(e,t){var n=new this(s,t);return h(n,e),n},T.prototype={constructor:T,then:function(t,n){var r=this.a;if(1===r&&!t||2===r&&!n)return this;var o=new this.constructor(s),i=this.b;if(r){var a=arguments[r-1];e(function(){g(r,o,a,i)})}else m(this,o,t,n);return o},"catch":function(e){return this.then(null,e)}};var N={Promise:T,polyfill:function(){var e;e="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self,"Promise"in e&&"resolve"in e.Promise&&"reject"in e.Promise&&"all"in e.Promise&&"race"in e.Promise&&function(){var n;return new e.Promise(function(e){n=e}),t(n)}()||(e.Promise=T)}};"function"==typeof define&&define.amd?define(function(){return N}):"undefined"!=typeof module&&module.exports?module.exports=N:"undefined"!=typeof this&&(this.ES6Promise=N)}).call(this),Array.prototype.map||(Array.prototype.map=function(e,t){var n,r,o;if(null==this)throw new TypeError(" this is null or not defined");var i=Object(this),a=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),r=new Array(a),o=0;a>o;){var s,l;o in i&&(s=i[o],l=e.call(n,s,o,i),r[o]=l),o++}return r}),function(e,t){"use strict";function n(){t.route=T,t.bindingHandlers.routeTemplate=D}function r(e){return e.replace(P,"")}function o(e,t){return"true"===r((e.getAttribute(t)||"").toLowerCase())}function i(e){return"object"==typeof e&&"number"==typeof e.length}function a(e){return null==e?null:":"===e[0]?S.dataType(e.slice(1)):"="===e[0]?S.equals(e.slice(1)):null}function s(e,t){return t[e.areaRouteKey]?e.router.getView(t[e.viewRouteKey],t[e.areaRouteKey]):e.router.getView(t[e.viewRouteKey])}function l(e){this.isDisposed=!1,this.disposalCallback=e}function u(e,t){var n={pathSeperator:"/"};t=this.options=T.utils.defaults(n,t||{}),this.routeTemplate=e,this.segments=u.parseTemplate(e,t.pathSeperator)}function c(e){function n(){var e=o.getPath();"string"==typeof e&&r(e),o.pathChanged.notifySubscribers(e)}function r(t){i.length>=e.maxHistoryEntries&&i.splice(0,1+(e.maxHistoryEntries-i.length)),i.push(t)}var o=this,i=[];e=T.utils.defaults({maxHistoryEntries:100},e||{}),o.pathChanged=new t.subscribable,o.setPath=function(e){e?window.location.hash=o.decorate(e):window.location.hash=""},o.getPath=function(){return window.location.hash.slice(1)},o.decorate=function(e){return 0===e.indexOf("#/")?e:"/"===e[0]?"#"+e:"#"===e[0]?"#/"+e.slice(1):"#/"+e},o.start=function(e){T.utils.attachEvent(window,"hashchange",n),e!==!1&&n()},o.stop=function(){T.utils.detachEvent(window,"hashchange",n)},o.peekBack=function(){return i.length>=2?i[i.length-2]:void 0},o.back=function(e){return i.length>1?(i.pop(),o.setPath(i.pop()),"function"==typeof e&&window.setTimeout(e,1),!0):!1}}function p(e){function n(t){var n,r=new RegExp(e.basePath,"gi");return(n=r.exec(t))?n[0]:""}function r(t){var n,r=new RegExp(e.basePath,"gi");return(n=r.exec(t))?t.substr(n[0].length):t}function o(){var e=a.getPath();"string"==typeof e&&i(e),a.pathChanged.notifySubscribers(e)}function i(t){s.length>=e.maxHistoryEntries&&s.splice(0,1+(e.maxHistoryEntries-s.length)),s.push(t)}var a=this,s=[],l={basePath:"^",maxHistoryEntries:100};e=T.utils.defaults(l,e||{}),a.pathChanged=new t.subscribable,a.setPath=function(e){window.history.pushState({},"",n(window.location.pathname)+e),a.pathChanged.notifySubscribers(e)},a.getPath=function(){return r(window.location.pathname)},a.decorate=function(e){return e},a.start=function(e){T.utils.attachEvent(window,"popstate",o),e!==!1&&o()},a.stop=function(){T.utils.detachEvent(window,"popstate",o)},a.back=function(e){return s.length>=2?(s.pop(),a.setPath(s.pop()),"function"==typeof e&&window.setTimeout(e,1),!0):!1}}function d(){}function f(){}function h(e){var t={createTemplates:!0,useTags:!0,tagName:"script",templateContainer:null,cache:!0,cacheNodes:!0};if(this.options=T.utils.defaults(t,e||{}),this.templateCache={},"undefined"==typeof jQuery)throw"jQuery is required to use the DomTemplateProvider"}function m(){}function v(e){var n=this,r={name:null,views:[]};t.utils.extend(n,T.utils.defaults(r,e||{}))}function w(e){var n=this,r={name:null,area:null,model:null,modelInstance:null,templateID:null,activeTemplateID:null,templateSrc:null,templatePersist:!1,singleton:!1,content:null,scope:null,resetScroll:!0,onModelCreating:null,onModelUnloading:null,handler:null};t.utils.extend(n,T.utils.defaults(r,e||{})),n.activeTemplateID=t.observable(n.activeTemplateID)}function g(){this._channels={},this._subs=[]}function y(e){function n(e){return{path:e,isCancelled:!1,cancel:function(){this.isCancelled||(this.isCancelled=!0,S.pathProvider.stop(),S.pathProvider.back(function(){S.pathProvider.start(!1)}))},isPersistModelSet:!1,persistModel:function(){this.isPersistModelSet=!0},isPreventDisposeSet:!1,preventDispose:function(){this.isPreventDisposeSet=!0}}}function r(t,n,r){var o,i,a,s=t.templateID,l=!0,u={cancel:function(){throw new Error("Cancel Not Implemented")},setTemplate:function(e){if(!l)throw"Template cannot be set at this time.";s=e}};return o=t.modelInstance&&"function"==typeof t.modelInstance[n]?b.resolve(t.modelInstance[n].apply(t.modelInstance,[r,u])):b.resolve(null),l=!1,s!==t.templateID||n===e.loadMethodName?(i=S.getTemplate(s,t),a=c(i),b.all([o,a])):o}function o(e,t){S.onUnload.notifySubscribers({context:this,routeValues:t.routeValues,navigation:t}),t.isCancelled||("function"==typeof e.onModelUnloading&&e.onModelUnloading.apply(e,[t.routeValues,e.modelInstance,t]),t.isCancelled||null!=e.modelInstance&&"function"==typeof e.modelInstance.unload&&e.modelInstance.unload.apply(e.modelInstance,[t.routeValues,t])===!1&&t.cancel())}function a(e){e.singleton!==!0&&null!=e.modelInstance&&"function"==typeof e.modelInstance.dispose&&e.modelInstance.dispose.apply(e.modelInstance)}function l(e){var t;for(t=0;t<M.length;t++)M[t]!==e&&null!=M[t].modelInstance&&null!=M[t].scope&&M[t].scope!==e.scope&&a(M[t],e)}function u(t,n,i){var s,u=[],c=F(),p=!1;if(j&&j.abort("abort"),t===c)return void r(t,e.updateMethodName,n)["catch"](function(t){v("Error",e.errorTemplateID,t,n)});if(o(c,i),!i.isCancelled){j=T.utils.abortable(function(){F(t),j=null,t.resetScroll!==!1&&S.scrollProvider.resetScroll(),S.onLoaded.notifySubscribers({routeValues:n,navigation:i,context:this})}),"function"==typeof t.onModelCreating&&t.onModelCreating.apply(t,[n,i]),s=t.modelInstance||t.model||{},S.onLoading.notifySubscribers({routeValues:n,navigation:i,context:this}),"function"==typeof s?t.modelInstance=S.modelFactory.createModel(s,[S,n]):t.modelInstance=s;try{i.isPreventDisposeSet||(a(c),l(t)),c.singleton||i.isPersistModelSet||(c.modelInstance=null),c.activeTemplateID()&&c.activeTemplateID()!==t.templateID&&("function"==typeof c.disposeTemplate?c.disposeTemplate():S.templateProvider.unloadTemplate(c.activeTemplateID())),u.push(r(t,e.loadMethodName,n).then(function(){return r(t,e.updateMethodName,n)}))}catch(d){return v("Error",e.errorTemplateID,d,n),b.reject(d)}return b.all(u).then(j)["catch"](function(t){j=null,"abort"===t||p||(p=!0,v("Error",e.errorTemplateID,t,n))})}}function c(e){var n,r;return"string"==typeof e?(n=S.getTemplate(e),r=e):(n=e,r=e.templateID),S.templateProvider.loadTemplate(n).then(function(n){n.templateNodes&&(e.templateNodes=n.templateNodes),t.isWriteableObservable(e.activeTemplateID)&&e.activeTemplateID(r)})}function p(t,n){var r,o,i;for(r=0;r<n.length;r++)if(i=n[r].route.match(t,n[r].defaults)){if(o=e.viewResolver.call(null,{areaRouteKey:e.areaRouteKey,viewRouteKey:e.viewRouteKey,router:S},i),null==o)continue;return{view:o,routeValues:i,route:n[r]}}return null}function f(e,t,n){var r,o,i,a;for(r=n.length-1;r>=0;r--)if(o=n[r].route.resolve(e,t))return i=n[r].route,a=n[r].defaults,{route:i,defaults:a,path:o};return null}function h(e){var n;return n=p(e,N),null==n&&(n=p(e,V)),null==n||null==n.routeValues||null==n.view?null:{view:n.view,route:n.route,routeValues:t.utils.extend(n.routeValues,T.utils.parseQueryString(e))}}function v(t,n,r,o){var i,a={routeValues:o,context:this,error:r,errorHandled:!1},s=new T.View({name:t,modelInstance:{name:t,routeValues:o,error:r},content:null});S.onLoadError.notifySubscribers(a),!a.errorHandled&&n?(i=S.getTemplate(n,{templateID:n}),"function"==typeof e.errorModel&&(s.modelInstance=new e.errorModel(o,r)),c(i).then(function(){s.activeTemplateID(i.templateID),F(s)},function(e){s.content="Failed to load the error template.",F(s)})):a.errorHandled||(s.content="An error occurred while loading the view.",F(s))}function w(t){var r=h(t),o=n(t);return null==r?o.routeValues=null:(o.routeValues=r.routeValues,o.view=r.view),null==r?void v("NotFound",e.notFoundTemplateID,"Path not found"):void u(r.view,r.routeValues,o)}function g(e){I&&(I.dispose(),I=null),S.pathProvider&&S.pathProvider.stop(),S.pathProvider=e,I=S.pathProvider.pathChanged.subscribe(w),C&&S.pathProvider.start()}function y(){C||(F(E),S.pathProvider.start(),C=!0)}function P(e){var t,n;if(t=e instanceof T.View?e:new T.View(e),null==t.area)M.push(t);else{if(n=S.getArea(t.area),null==n)throw"Invalid area name on view";n.addView(t)}}var I,E,S=this,D={routes:[{template:"{view}/{id?}",defaults:{view:"home"}}],areas:[],views:[],templates:[],viewRouteKey:"view",areaRouteKey:"area",loadMethodName:"load",updateMethodName:"update",pathProvider:"hash",templateProvider:"default",scrollProvider:"window",defaultContent:"Loading...",defaultTemplateID:"",defaultTemplateNodes:null,errorTemplateID:"",notFoundTemplateID:"",viewResolver:s},C=!1,A=[],V=[],N=[],R=[],M=[],j=null;e=T.utils.defaults(D,e||{}),E=new T.View({name:null,templateID:e.defaultTemplateID,templateNodes:e.defaultTemplateNodes,content:e.defaultContent});var F=t.observable(E);S.pathProvider=null,g(new T.HashPathStringProvider),S.templateProvider=new T.DefaultTemplateProvider,S.modelFactory=new d,S.scrollProvider=new m,S.bus=new T.Bus,S.clearTemplates=function(){T.utils.clearArray(A)},S.clearRoutes=function(){T.utils.clearArray(V),T.utils.clearArray(N)},S.clearViews=function(){T.utils.clearArray(R),T.utils.clearArray(N),T.utils.clearArray(M)},S.addTemplates=function(e){e&&e.forEach&&e.forEach(function(e){A.push(e)})},S.addAreas=function(e){if(!e||!e.forEach)throw new TypeError("newAreas must be an array.");e.forEach(function(e){R.push(new T.Area(e)),i(e.routes)?e.routes.forEach(function(n){N.push({route:new T.Route("{area="+e.name+"}/"+n.template),defaults:t.utils.extend({},n.defaults)})}):N.push({route:new T.Route("{area="+e.name+"}/"+V[0].route.routeTemplate),defaults:t.utils.extend({},V[0].defaults)})})},S.addViews=function(e){if(!e||!e.forEach)throw new TypeError("addedViews must be an array.");e.forEach(function(e){P(e)})},S.insertRoutes=function(e){var t;if(!e||!e.length)throw new TypeError("insertedRoutes must be an array.");for(t=e.length-1;t>=0;t--)V.splice(0,0,{route:new T.Route(e[t].template),defaults:e[t].defaults})},S.addRoutes=function(e){if(!e||!e.forEach)throw new TypeError("addedRoutes must be an array.");e.forEach(function(e){V.push({route:new T.Route(e.template),defaults:e.defaults})})},S.getArea=function(e){return t.utils.arrayFirst(R,function(t){return t.name===e})},S.getView=function(e,n){var r;return 1===arguments.length?t.utils.arrayFirst(M,function(t){return t.name===e}):2===arguments.length?(r=S.getArea(n),null==r?null:r.getView(e)):null},S.getTemplate=function(e,n){var r=t.utils.arrayFirst(A,function(t){return t.templateID===e});return r?r:n},S.setOptions=function(n){if(null==n)throw new TypeError("newOptions must be an object.");t.utils.extend(e,n),i(n.templates)&&(S.clearTemplates(),S.addTemplates(n.templates)),i(n.routes)&&(S.clearRoutes(),S.addRoutes(n.routes)),i(n.areas)&&i(n.views)?(S.clearViews(),S.addAreas(n.areas),S.addViews(n.views)):i(n.areas)?(S.clearViews(),S.addAreas(n.areas)):i(n.views)&&(S.clearViews(),S.addViews(n.views)),"object"==typeof n.templateProvider?S.templateProvider=n.templateProvider:"ajax"===n.templateProvider&&(S.templateProvider=new T.AjaxTemplateProvider),"object"==typeof n.pathProvider?g(n.pathProvider):"history"===n.pathProvider&&g(new T.HistoryPathStringProvider(n.basePath)),"object"==typeof n.scrollProvider?S.scrollProvider=n.scrollProvider:"window"===n.scrollProvider&&(S.scrollProvider=new T.WindowScrollProvider)},S.resolve=function(e,t){var n,r,o="",i={},a=!1;if(t||(n=S.pathProvider.getPath()),r=f(e,n,N),null==r&&(r=f(e,n,V)),null==r)throw"No matching route for given path";o+=r.route.resolve(e,n,r.defaults);for(var s in e)e.hasOwnProperty(s)&&!r.route.hasKey(s)&&void 0===i[s]&&(i[s]=e[s],a=!0);return a&&(o+=x+T.utils.serializeQueryString(i)),this.pathProvider.decorate(o)},S.navigate=function(e,t){var n;if(n="string"==typeof e&&1===arguments.length?e:S.resolve(e,t),null==n)throw"No matching route or path exists.";S.pathProvider.setPath(n)},S.navigateBack=function(){return"function"==typeof S.pathProvider.back?new b(function(e,t){S.pathProvider.back(e)}):new b.resolve(null)},S.setView=function(e,t,r){var o;e instanceof T.View||(e=new T.View(e)),e!=F()&&(t=t||{},"string"==typeof r?(this.pathProvider.stop(),this.pathProvider.setPath(r),this.pathProvider.start(!1)):r=this.pathProvider.getPath(),o=n(r),u(e,t,o))},S.setTemplate=function(e){F().activeTemplateID(e)},S.dispose=function(){S.pathProvider.stop();var e=!1;I&&(I.dispose(),I=null);for(var t=0;t<M.length;t++)a(M[t]),M[t]===F()&&(e=!0);e||(o(F()),a(F())),F(null)},S.init=y,S.view=t.computed(function(){return F()}),S.onLoading=new t.subscribable,S.onLoaded=new t.subscribable,S.onUnload=new t.subscribable,S.onLoadError=new t.subscribable,this.setOptions(e)}var b=e.Promise||e.ES6Promise.Promise,T={},P=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,I="\\{(\\w+)([=:]\\w+)?(\\??)\\}",E=/^[\w\+\.\-\~]+$/i,x="?",S={equals:function(e){return function(t){return e===t}},dataType:function(e){var t=/.*/;return"float"===e?t=/^[-+]?\d*\.?\d*$/i:"int"===e?t=/^[-+]?\d*$/i:"hex"===e&&(t=/^[a-fA-F0-9]*$/i),function(e){return t.test(e)}}};T.defaultViewResolver=s,T.utils=T.utils||{},T.utils.clearArray=function(e){for(;e.length>0;)e.pop()},T.utils.defaults=function(e,t){for(var n in e)t.hasOwnProperty(n)||"undefined"!=typeof t[n]||"undefined"==typeof e[n]||(t[n]=e[n]);return t},T.utils.parseQueryString=function(e){var t={},n=(e||"").indexOf("?"),r=0;if(n>=0&&(e=e.slice(n+1)),"undefined"!=typeof e)for(var o,i=e.split("&"),a=0;a<i.length;a++)o=i[a].split("="),2===o.length&&(t[o[0]]=decodeURIComponent(o[1]),r++);return r>0?t:null},T.utils.serializeQueryString=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+"="+e[n]);return t.join("&")},T.utils.attachEvent=function(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else{if(!e.attachEvent)throw"No event subscription method available.";e.attachEvent("on"+t,n)}},T.utils.detachEvent=function(e,t,n){if(e.removeEventListener)e.removeEventListener(t,n,!1);else{if(!e.detachEvent)throw"No event subscription method available.";e.detachEvent("on"+t,n)}},T.utils.abortable=function(e){function t(){return n?b.reject(n):b.resolve(e.apply(this,arguments))}var n=null;return t.abort=function(e){n=e},t},T.utils.setTextContent=function(e,t){e&&"undefined"!=typeof e.innerHTML?e.innerHTML=t:e&&"undefined"!=typeof e.textContent?e.textContent=t:e&&"undefined"!=typeof e.innerText&&(e.innerText=t)},l.prototype.dispose=function(){this.isDisposed||(this.disposalCallback(),this.isDisposed=!0)},u.parseSegmentValue=function(e,t){switch(e=decodeURIComponent(e),t){case"float":return parseFloat(e);case"int":return parseInt(e,10);case"hex":return parseInt(e,16);default:return e}},u.parseTemplate=function(e,t){var n,r=[],o=!1;0===e.indexOf(t)&&(e=e.slice(t.length)),n=e.split(t);for(var i=0;i<n.length;i++)if(n[i]){for(var s,l=[],u=new RegExp(I,"gi");s=u.exec(n[i]);)l.push(s);if(1===l.length){var c=!1,p=l[0][2]&&":"===l[0][2][0]?l[0][2].slice(1):"string";if("params"===p?(r.push({value:n[i],parts:[{name:l[0][1],optional:!0,type:"params",dataType:"string"}]}),c=!0):r.push({value:n[i],parts:[{name:l[0][1],optional:c="?"===l[0][3],type:"parameter",constraint:a(l[0][2]),dataType:p}]}),o&&!c)throw"Invalid route template: A required segment cannot follow an optional one.";o=o||c}else{if(l.length>1)throw"Invalid route template: Multi-part route segments are not implemented";if(E.test(n[i]))r.push({value:n[i],parts:[{name:n[i],optional:!1,type:"literal"}]});else{if("*"!==n[i])throw"Invalid route template: The segment value '"+n[i]+"' is invalid.";r.push({value:n[i],parts:[{name:n[i],optional:!1,type:"wildcard",dataType:"string"}]})}}}return r},u.prototype.match=function(e,t){var n,r,o,i={};if(null==e)throw"A value for path must be specified.";0===e.indexOf(this.options.pathSeperator)&&(e=e.slice(this.options.pathSeperator.length));var a=-1;(a=e.indexOf("?"))>=0&&(e=e.slice(0,a)),n=e.split(this.options.pathSeperator);for(var s=0;s<n.length;s++)if(r=n[s],o=this.segments.length>s?this.segments[s]:null,null==o){if(r.length>0)return null}else{if(1!==o.parts.length)throw"Multi-part route segments are not implemented";var l=o.parts[0];if("literal"===l.type){if(l.name!==r)return null}else if("wildcard"===l.type);else if("parameter"===l.type&&r.length>0){if(null!=l.constraint&&!l.constraint(r))return null;i[l.name]=u.parseSegmentValue(r,l.dataType)}else{if("parameter"!==l.type){if("params"===l.type&&this.segments.length-1==s){i[l.name]=n.slice(s).map(decodeURIComponent);break}return null}var c;if(t&&(c=t[l.name]))i[l.name]=c;else if(!l.optional)return null}}for(var s=n.length;s<this.segments.length;s++){if(o=this.segments[s],o.parts.length>1)return null;var l=o.parts[0];if("literal"===l.type)return null;var c;if(t&&(c=t[l.name])||"wildcard"===l.type)i[l.name]=c;else if(!l.optional)return null}if(null!=t)for(var p in t)t.hasOwnProperty(p)&&!i.hasOwnProperty(p)&&(i[p]=t[p]);return i},u.prototype.resolve=function(e,n,r){var o,i,a,s,l=[],u=Number.MAX_VALUE,c=!1,p=-1;"string"==typeof n&&n.length>0&&(n[0]===this.options.pathSeperator&&(n=n.slice(1)),(p=n.indexOf("?"))>=0&&(n=n.slice(0,p)),o=n.split(this.options.pathSeperator));for(var d=0;d<this.segments.length;d++){if(a=this.segments[d],i=o&&o[d]?decodeURI(o[d]):null,1!==a.parts.length)throw"Multi-part route segments are not supported.";if(s=a.parts[0],"wildcard"===s.type){if(!(i&&i.length>0))return null;l.push(i)}else if("literal"===s.type)l.push(s.name);else if("parameter"===s.type){if(e.hasOwnProperty(s.name)){if(c=!0,null!=s.constraint&&!s.constraint(e[s.name]))return null;l.push(e[s.name])}else if(!c&&i&&i.length>0){if(null!=s.constraint&&!s.constraint(i))return null;l.push(i)}else if("object"==typeof r&&r.hasOwnProperty(s.name))l.push(r[s.name]);else if(!s.optional)return null}else if("params"===s.type&&d==this.segments.length-1){var f=e[s.name];f&&(f=f.map(encodeURIComponent).join(this.options.pathSeperator),f.length&&(u=l.length,l.push(f)))}}var h=0;return t.utils.arrayForEach(this.segments,function(e){e.parts[0].optional||h++}),l.length<h?null:l.map(function(e,t){return u>t?encodeURIComponent(e):e}).join(this.options.pathSeperator)},u.prototype.hasKey=function(e){for(var t=0;t<this.segments.length;t++)for(var n=0;n<this.segments[t].parts.length;n++)if(this.segments[t].parts[n].name===e)return!0;return!1},T.Route=u,T.HashPathStringProvider=c,T.HistoryPathStringProvider=p,d.prototype.createModel=function(e,t){function n(){return e.apply(this,t)}if("function"==typeof e)return n.prototype=e.prototype,new n;throw"constructor must be a valid constructor function."},f.prototype.loadTemplate=function(e){var t=window.document.getElementById(e.templateID);if(!t)throw"There is no element with id "+e.templateID+".";if("script"!==t.tagName.toLowerCase())throw"The element with id "+e.templateID+" must be a <script> tag in order to use it as a template.";return b.resolve({success:!0,statusCode:203,template:t})},f.prototype.unloadTemplate=function(e){},T.DefaultTemplateProvider=f,h.prototype.loadTemplateTag=function(e){var t=window.document.getElementById(e.templateID),n=this.options.templateContainer||window.document.body,r=this;if(this.options.createTemplates&&!t&&e.templateSrc)t=window.document.createElement(this.options.tagName),t.type="text/html",t.id=e.templateID,this.options.cache?t.setAttribute("data-src",e.templateSrc):t.setAttribute("data-src",e.templateSrc+"?v="+(new Date).getTime().toString()),e.templatePersist&&t.setAttribute("data-persist","true"),n.appendChild(t);else if(!t)throw"There is no template defined with id '"+e.templateID+"'";if(t.tagName.toLowerCase()!==this.options.tagName)throw"The element with id "+e.templateID+" must be a <"+this.options.tagName+"> tag in order to use it as a template.";var i=e.templateSrc||t.getAttribute("data-src"),a=o(t,"data-loaded"),s={success:!1,statusCode:0,template:t};return new b(function(e,n){i&&!a?(r.options.cache||(i+="?v="+(new Date).getTime().toString()),jQuery.get(i).done(function(n,r,o){t.text=n,t.setAttribute("data-loaded","true"),s.success=!0,s.statusCode=o.status,s.statusText=o.statusText,e(s)}).fail(function(e,t,r){s.success=!1,s.statusCode=e.status,s.statusText=e.statusText,n(s)})):(s.success=!0,s.statusCode=203,e(s))})},h.prototype.loadTemplateNodes=function(e){var n=this,r={success:!1,statusCode:0};if(null==e.templateID)throw new Error("The templateID must be provided for the given view.");return new b(function(o,i){var a,s,l=n.templateCache[e.templateID];if(l)r.templateNodes=l.nodes,r.success=!0,r.statusCode=203,o(r);else if(s=window.document.getElementById(e.templateID))r.templateNodes=t.utils.parseHtmlFragment(s.text),r.success=!0,r.statusCode=203,o(r);else{if(null==e.templateSrc)throw new Error("The templateSrc must be provided for the given view.");a=e.templateSrc,n.options.cache||(a+="?v="+(new Date).getTime().toString()),jQuery.get(a).done(function(i,a,s){var l=$(i);"TEMPLATE"===l.prop("tagName")?l[0].content?r.templateNodes=l[0].content.childNodes:r.templateNodes=t.utils.parseHtmlFragment(l.html()):"SCRIPT"===l.prop("tagName")?r.templateNodes=t.utils.parseHtmlFragment(l[0].text):r.templateNodes=l.toArray(),n.options.cacheNodes&&e.templatePersist&&(n.templateCache[e.templateID]={persist:e.templatePersist,nodes:r.templateNodes}),r.success=!0,r.statusCode=s.status,r.statusText=s.statusText,o(r)}).fail(function(e,t,n){r.success=!1,r.statusCode=e.status,r.statusText=e.statusText,i(r)})}})},h.prototype.loadTemplate=function(e){return this.options.useTags?this.loadTemplateTag(e):this.loadTemplateNodes(e)},h.prototype.unloadTemplate=function(e){if(this.options.useTags){if("string"==typeof e&&(e=window.document.getElementById(e)),!(e instanceof HTMLScriptElement))throw"The 'template' parameter must be an element ID or an HTMLScriptElement";if(o(e,"data-persist")||null==e.getAttribute("data-src"))return;e.setAttribute("data-loaded","false"),e.text=""}},"undefined"!=typeof jQuery&&(T.AjaxTemplateProvider=h),m.prototype.resetScroll=function(){window.scrollTo(0,0)},T.WindowScrollProvider=m,v.prototype.getView=function(e){return t.utils.arrayFirst(this.views,function(t){return t.name===e})},v.prototype.addView=function(e){this.views.push(e)},v.prototype.clearViews=function(){T.utils.clearArray(this.views)},T.Area=v,T.View=w,g.prototype.publish=function(e,t,n){this._channels[e]&&this._channels[e].notifySubscribers(n,t)},g.prototype.subscribe=function(e,n,r){var o=this;this._channels[e]=this._channels[e]||new t.subscribable;var i=o._channels[e].subscribe(r,o,n),a=new l(function(){i.dispose(),t.utils.arrayRemoveItem(o._subs,a),o._channels[e]&&o._channels[e].getSubscriptionsCount()<=0&&(o._channels[e]=null)});return this._subs.push(a),a},g.prototype.dispose=function(){for(;this._subs.length>0;)this._subs.pop().dispose()},g["default"]=new g,T.Bus=g,T.ViewRouter=y;var D={init:function(e,n,r,o,i){var a=t.bindingHandlers.template.init(e,function(){return""}),s=t.utils.unwrapObservable(n());return t.computed(function(){var n,a=s.view(),l=function(){return n};if(!a)return void T.utils.setTextContent(e,"<h2>Error</h2><p>Something went wrong when trying to display content.</p>");if(a.content&&a.modelInstance&&a.modelInstance.error)return void T.utils.setTextContent(e,"<h2>Error</h2><p>"+a.content+"</p><p>"+(a.modelInstance.error.stack?a.modelInstance.error.stack:"")+"</p>");if(a.content)return void T.utils.setTextContent(e,a.content);if(n={data:a.modelInstance},a.templateNodes?n.nodes=a.templateNodes:n.name=t.unwrap(a.activeTemplateID)||a.templateID,!n.data||!n.name&&!n.nodes)throw"Failed to load view";t.bindingHandlers.template.init(e,l),t.bindingHandlers.template.update(e,l,r,o,i)},this,{disposeWhenNodeIsRemoved:e}).extend({rateLimit:10}),s.init(),a},update:function(e,t,n,r,o){}};n()}(window,ko);