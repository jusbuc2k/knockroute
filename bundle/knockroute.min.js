(function(n,t){"use strict";function v(){t.route=i;t.bindingHandlers.routeTemplate=a}function k(){i.utils.trim=function(n){return n.replace(y,"")}}function h(n,t){return k((n.getAttribute(t)||"").toLowerCase()==="true")}function f(n){return typeof n=="object"&&typeof n.length=="number"}function d(n){return n==null?null:n[0]===":"?c.dataType(n.slice(1)):n[0]==="="?c.equals(n.slice(1)):null}function u(n,t){var r=this;t=this.options=i.utils.defaults({pathSeperator:"/"},t||{});this.routeTemplate=n;this.segments=u.parseTemplate(n,t.pathSeperator)}function g(){function r(){var t=n.getPath();n.pathChanged.notifySubscribers(t);u=t}var n=this,u="";n.pathChanged=new t.subscribable;n.setPath=function(t){window.location.hash=t?n.decorate(t):""};n.getPath=function(){return window.location.hash.slice(1)};n.decorate=function(n){return n.indexOf("#/")===0?n:n[0]==="/"?"#"+n:n[0]==="#"?"#/"+n.slice(1):"#/"+n};n.start=function(){i.utils.attachEvent(window,"hashchange",r);r()};n.stop=function(){i.utils.detachEvent(window,"hashchange",r)};n.revert=function(t){n.setPath(u);typeof t=="function"&&window.setTimeout(t,20)}}function nt(n){function e(t){var r=new RegExp(n.basePath,"gi"),i;return(i=r.exec(t))?i[0]:""}function o(t){var r=new RegExp(n.basePath,"gi"),i;return(i=r.exec(t))?t.substr(i[0].length):t}function u(){var n=r.getPath();r.pathChanged.notifySubscribers(n);f=n}var r=this,f="";n=i.utils.defaults({basePath:"^"},n||{});r.pathChanged=new t.subscribable;r.setPath=function(n){window.history.pushState({},"",e(window.location.pathname)+n);r.pathChanged.notifySubscribers(n)};r.getPath=function(){return o(window.location.pathname)};r.decorate=function(n){return n};r.start=function(){i.utils.attachEvent(window,"popstate",u);u()};r.stop=function(){i.utils.detachEvent(window,"popstate",u)};r.revert=function(n){r.setPath(f);window.setTimeout(n,20)}}function l(){var n=this}function o(){var n=this}function s(n){var t=this;if(this.options=i.utils.defaults({createTemplates:!0,templateContainer:null,cache:!0},n||{}),typeof jQuery=="undefined")throw"jQuery is required to use the DomTemplateProvider";}function e(n){var r=this;t.utils.extend(r,i.utils.defaults({name:null,views:[]},n||{}))}function tt(n){var r=this;t.utils.extend(r,i.utils.defaults({name:null,area:null,model:null,modelInstance:null,templateID:null,activeTemplateID:null,templateSrc:null,templatePersist:!1,singleton:!1,content:null},n||{}));r.activeTemplateID=t.observable(r.activeTemplateID)}function it(n){function d(n,t,i){var e,f=n.templateID,o,s=!0,h={cancel:function(){},setTemplate:function(n){if(s)f=n;else throw"Template cannot be set at this time.";}};return e=n.modelInstance&&typeof n.modelInstance[t]=="function"?r.resolve(n.modelInstance[t].apply(n.modelInstance,[i,h])):r.resolve(null),s=!1,o=u.getTemplate(f,n),r.all([e,u.templateProvider.loadTemplate(o).then(function(){n.activeTemplateID(f)})])}function g(n,t){function i(){(t||!n.singleton)&&(n.modelInstance!=null&&typeof n.modelInstance.dispose=="function"&&n.modelInstance.dispose.apply(n.modelInstance),n.modelInstance=null)}return n.modelInstance!=null&&typeof n.modelInstance.unload=="function"?r.resolve(n.modelInstance.unload.apply(n.modelInstance,[t])).then(i):(i(),r.resolve(!0))}function ut(t,f,o){var h,c=[];s&&s.abort("abort");s=i.utils.abortable(function(){e(t);s=null;u.onLoaded.notifySubscribers({routeValues:f,context:this})});h=t.modelInstance||t.model||{};u.onLoading.notifySubscribers({routeValues:f,context:this});t.modelInstance=typeof h=="function"?u.modelFactory.createModel(h,[u,f]):h;try{c.push(g(e(),!1).then(function(n){n===!1&&o();e().activeTemplateID()&&e().activeTemplateID()!==t.templateID&&u.templateProvider.unloadTemplate(e().activeTemplateID())}));c.push(d(t,n.loadMethodName,f).then(function(){return d(t,n.updateMethodName,f)}))}catch(l){return y("Error",n.errorTemplateID,l,f),r.reject(l)}return r.all(c).then(s)["catch"](function(t){s=null;t!=="abort"&&y("Error",n.errorTemplateID,t,f)})}function ft(n){var t;return t=typeof n=="string"?u.getTemplate(n):n,u.templateProvider.loadTemplate(t)}function nt(t,i){for(var e,r,f=0;f<i.length;f++)if(r=i[f].route.match(t,i[f].defaults)){if(e=r[n.areaRouteKey]?u.getView(r[n.viewRouteKey],r[n.areaRouteKey]):u.getView(r[n.viewRouteKey]),e==null)continue;return{view:e,routeValues:r}}return null}function tt(t,i,r){for(var s,o,e,f=0;f<r.length;f++)if(s=r[f].route.resolve(t,i)){if(o=r[f].route,e=r[f].defaults,t[n.areaRouteKey]&&(!e[n.areaRouteKey]||!u.getArea(e[n.areaRouteKey])))continue;return{route:o,defaults:e}}return null}function et(n){var r;return(r=nt(n,c),r==null&&(r=nt(n,h)),r==null||r.routeValues==null||r.view==null)?null:{view:r.view,routeValues:t.utils.extend(r.routeValues,i.utils.parseQueryString(n))}}function y(t,r,f,o){var h,c={routeValues:o,context:this,error:f,errorHandled:!1},s=new i.View({name:t,modelInstance:{name:t,routeValues:o,error:f},content:null});u.onLoadError.notifySubscribers(c);!c.errorHandled&&r?(h=u.getTemplate(r,{templateID:r}),typeof n.errorModel=="function"&&(s.modelInstance=new n.errorModel(o,f)),ft(h).then(function(){s.activeTemplateID(h.templateID);e(s)},function(){s.content="Failed to load the error template.";e(s)})):c.errorHandled||(s.content="An error occurred while loading the view.",e(s))}function it(t){var i=et(t);if(i==null){y("NotFound",n.notFoundTemplateID,"Path not found");return}i.view===e()?d(i.view,n.updateMethodName,i.routeValues)["catch"](function(t){y("Error",n.errorTemplateID,t,i.routeValues)}):ut(i.view,i.routeValues,function(){u.pathProvider.stop();u.pathProvider.revert(function(){u.pathProvider.start()})})}function rt(n){o&&(o.dispose(),o=null);u.pathProvider&&u.pathProvider.stop();u.pathProvider=n;o=u.pathProvider.pathChanged.subscribe(it);p&&u.pathProvider.start()}function ot(){p||(e(v),u.pathProvider.start(),p=!0)}function st(n){var t,r;if(t=n instanceof i.View?n:new i.View(n),t.area==null)a.push(t);else{if(r=u.getArea(t.area),r==null)throw"Invalid area name on view";r.addView(t)}}var u=this,p=!1,w=[],h=[],c=[],k=[],a=[],o,s=null,v,e;n=i.utils.defaults({routes:[{template:"{view}/{id?}",defaults:{view:"home"}}],areas:[],views:[],templates:[],viewRouteKey:"view",areaRouteKey:"area",loadMethodName:"load",updateMethodName:"update",pathProvider:"hash",templateProvider:"default",defaultContent:"Loading...",defaultTemplateID:"",errorTemplateID:"",notFoundTemplateID:""},n||{});v=new i.View({name:null,templateID:n.defaultTemplateID,content:n.defaultContent});e=t.observable(v);u.pathProvider=new i.HashPathStringProvider;u.templateProvider=new i.DefaultTemplateProvider;u.modelFactory=new l;u.clearTemplates=function(){i.utils.clearArray(w)};u.clearRoutes=function(){i.utils.clearArray(h)};u.clearViews=function(){i.utils.clearArray(k);i.utils.clearArray(c);i.utils.clearArray(a)};u.addTemplates=function(n){n&&n.forEach&&n.forEach(function(n){w.push(n)})};u.addAreas=function(r){if(r&&r.forEach)r.forEach(function(r){k.push(new i.Area(r));f(r.routes)?r.routes.forEach(function(n){c.push({route:new i.Route("{area="+r.name+"}/"+n.route.routeTemplate),defaults:t.utils.extend({area:r.name},n.defaults)})}):c.push({route:new i.Route("{area="+r.name+"}/"+n.routes[0].template),defaults:t.utils.extend({area:r.name},n.routes[0].defaults)})});else throw new TypeError("newAreas must be an array.");};u.addViews=function(n){if(n&&n.forEach)n.forEach(function(n){st(n)});else throw new TypeError("addedViews must be an array.");};u.insertRoutes=function(n){var t;if(n&&n.length)for(t=n.length-1;t>=0;t--)h.splice(0,0,{route:new i.Route(n[t].template),defaults:n[t].defaults});else throw new TypeError("insertedRoutes must be an array.");};u.addRoutes=function(n){if(n&&n.forEach)n.forEach(function(n){h.push({route:new i.Route(n.template),defaults:n.defaults})});else throw new TypeError("addedRoutes must be an array.");};u.getArea=function(n){return t.utils.arrayFirst(k,function(t){return t.name===n})};u.getView=function(n,i){var r;return arguments.length===1?t.utils.arrayFirst(a,function(t){return t.name===n}):arguments.length===2?(r=u.getArea(i),r==null)?null:r.getView(n):null};u.getTemplate=function(n,i){var r=t.utils.arrayFirst(w,function(t){return t.templateID===n});return r?r:i};u.setOptions=function(r){if(r==null)throw new TypeError("newOptions must be an object.");t.utils.extend(n,r);f(r.templates)&&(u.clearTemplates(),u.addTemplates(r.templates));f(r.routes)&&(u.clearRoutes(),u.addRoutes(r.routes));f(r.areas)&&f(r.views)?(u.clearViews(),u.addAreas(r.areas),u.addViews(r.views)):f(r.areas)?(u.clearViews(),u.addAreas(r.areas)):f(r.views)&&(u.clearViews(),u.addViews(r.views));typeof r.templateProvider=="object"?u.templateProvider=r.templateProvider:r.templateProvider==="ajax"&&(u.templateProvider=new i.AjaxTemplateProvider);typeof r.pathProvider=="object"?rt(r.pathProvider):r.pathProvider==="history"&&rt(new i.HistoryPathStringProvider(r.basePath))};u.resolve=function(n,t){var e,o="",s={},l=!1,r,f;if(t||(e=u.pathProvider.getPath()),r=tt(n,e,c),r==null&&(r=tt(n,e,h)),r==null)throw"No matching route for given path";for(f in n)n.hasOwnProperty(f)&&!r.route.hasKey(f)&&(s[f]=n[f],l=!0);return i.utils.defaults(r.defaults,n),o+=r.route.resolve(n,e),l&&(o+=b+i.utils.serializeQueryString(s)),this.pathProvider.decorate(o)};u.navigate=function(n){var t;if(t=typeof n=="string"?n:u.resolve(n),t!=null)u.pathProvider.setPath(t);else throw"No matching route or path exists.";};u.setTemplate=function(n){e().activeTemplateID(n)};u.dispose=function(){u.pathProvider.stop();o&&(o.dispose(),o=null);for(var n=0;n<a.length;n++)g(a[n],!0);g(e(),!0);e(v)};u.init=ot;u.view=t.computed(function(){return e()});u.onLoading=new t.subscribable;u.onLoaded=new t.subscribable;u.onLoadError=new t.subscribable;this.setOptions(n)}var r=n.Promise||n.ES6Promise.Promise,i={},y=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p="\\{(\\w+)([=:]\\w+)?(\\??)\\}",w=/^[\w\+\.\-\~]+$/i,b="?",c={equals:function(n){return function(t){return n===t}},dataType:function(n){var t=/.*/;return n==="float"?t=/^[-+]?\d*\.?\d*$/i:n==="int"?t=/^[-+]?\d*$/i:n==="hex"&&(t=/^[a-fA-F0-9]*$/i),function(n){return t.test(n)}}},a;i.utils=i.utils||{};i.utils.clearArray=function(n){while(n.length>0)n.pop()};i.utils.defaults=function(n,t){for(var i in n)t.hasOwnProperty(i)||typeof t[i]!="undefined"||typeof n[i]=="undefined"||(t[i]=n[i]);return t};i.utils.parseQueryString=function(n){var u={},f=(n||"").indexOf("?"),e=0,r,t,i;if(f>=0&&(n=n.slice(f+1)),typeof n!="undefined")for(r=n.split("&"),i=0;i<r.length;i++)t=r[i].split("="),t.length===2&&(u[t[0]]=t[1],e++);return e>0?u:null};i.utils.serializeQueryString=function(n){var i=[];for(var t in n)n.hasOwnProperty(t)&&i.push(t+"="+n[t]);return i.join("&")};i.utils.nowOrThen=function(n){return new r(function(t,i){typeof n=="boolean"?n?t(n):i(n):n!=null&&typeof n.done=="function"?n.done(function(){t(arguments)}).fail(function(){i(arguments)}):n!=null&&typeof n.then=="function"?n.then(t,i):n!=null?t(n):t()})};i.utils.attachEvent=function(n,t,i){if(n.addEventListener)n.addEventListener(t,i,!1);else if(n.attachEvent)n.attachEvent("on"+t,i);else throw"No event subscription method available.";};i.utils.detachEvent=function(n,t,i){if(n.removeEventListener)n.removeEventListener(t,i,!1);else if(n.detachEvent)n.detachEvent("on"+t,i);else throw"No event subscription method available.";};i.utils.abortable=function(n){function i(){return t?r.reject(t):r.resolve(n.apply(this,arguments))}var t=null;return i.abort=function(n){t=n},i};i.utils.setTextContent=function(n,t){n&&typeof n.innerHTML!="undefined"?n.innerHTML=t:n&&typeof n.textContent!="undefined"?n.textContent=t:n&&typeof n.innerText!="undefined"&&(n.innerText=t)};u.parseSegmentValue=function(n,t){switch(t){case"float":return parseFloat(n);case"int":return parseInt(n,10);case"hex":return parseInt(n,16);default:return n}};u.parseTemplate=function(n,t){var f=[],r,o=!1,i,h,u,c,e,s;for(n.indexOf(t)===0&&(n=n.slice(t.length)),r=n.split(t),i=0;i<r.length;i++)if(r[i]){for(u=[],c=new RegExp(p,"gi");h=c.exec(r[i]);)u.push(h);if(u.length===1){if(e=!1,s=u[0][2]&&u[0][2][0]===":"?u[0][2].slice(1):"string",s==="params"?(f.push({value:r[i],parts:[{name:u[0][1],optional:!0,type:"params",dataType:"string"}]}),e=!0):f.push({value:r[i],parts:[{name:u[0][1],optional:e=u[0][3]==="?",type:"parameter",constraint:d(u[0][2]),dataType:s}]}),o&&!e)throw"Invalid route template: A required segment cannot follow an optional one.";o=o||e}else if(u.length>1)throw"Invalid route template: Multi-part route segments are not implemented";else if(w.test(r[i]))f.push({value:r[i],parts:[{name:r[i],optional:!1,type:"literal"}]});else if(r[i]==="*")f.push({value:r[i],parts:[{name:r[i],optional:!1,type:"wildcard",dataType:"string"}]});else throw"Invalid route template: The segment value '"+r[i]+"' is invalid.";}return f};u.prototype.match=function(n,t){var s,o,f,e={},l,r,i,c,h;if(n==null)throw"A value for path must be specified.";for(n.indexOf(this.options.pathSeperator)===0&&(n=n.slice(this.options.pathSeperator.length)),l=-1,(l=n.indexOf("?"))>=0&&(n=n.slice(0,l)),s=n.split(this.options.pathSeperator),r=0;r<s.length;r++)if(o=s[r],f=this.segments.length>r?this.segments[r]:null,f==null){if(o.length>0)return null}else if(f.parts.length===1){if(i=f.parts[0],i.type==="literal"){if(i.name!==o)return null}else if(i.type!=="wildcard")if(i.type==="parameter"&&o.length>0)if(i.constraint==null||i.constraint(o))e[i.name]=u.parseSegmentValue(o,i.dataType);else return null;else if(i.type==="parameter"){if(t&&(c=t[i.name]))e[i.name]=c;else if(!i.optional)return null}else if(i.type==="params"&&this.segments.length-1==r){e[i.name]=s.slice(r);break}else return null}else throw"Multi-part route segments are not implemented";for(r=s.length;r<this.segments.length;r++){if((f=this.segments[r],f.parts.length>1)||(i=f.parts[0],i.type==="literal"))return null;if(t&&(c=t[i.name])||i.type==="wildcard")e[i.name]=c;else if(!i.optional)return null}if(t!=null)for(h in t)t.hasOwnProperty(h)&&!e.hasOwnProperty(h)&&(e[h]=t[h]);return e};u.prototype.resolve=function(n,i){var f=[],s,u,h,r,e,o,c;for(i!=null&&(i[0]===this.options.pathSeperator&&(i=i.slice(1)),s=i.split(this.options.pathSeperator)),e=0;e<this.segments.length;e++)if(h=this.segments[e],u=s?s[e]:null,h.parts.length===1)if(r=h.parts[0],r.type==="wildcard")if(u&&u.length>0)f.push(u);else return null;else if(r.type==="literal")f.push(r.name);else if(r.type==="parameter"){if(n.hasOwnProperty(r.name))f.push(n[r.name]);else if(u&&u.length>0&&(r.constraint==null||r.constraint(u)))f.push(u);else if(!r.optional)return null}else r.type==="params"&&e==this.segments.length-1&&(o=n[r.name],o&&(o=o.join(this.options.pathSeperator),o.length&&f.push(o)));else throw"Multi-part route segments are not supported.";return(c=0,t.utils.arrayForEach(this.segments,function(n){n.parts[0].optional||c++}),f.length<c)?null:f.join(this.options.pathSeperator)};u.prototype.hasKey=function(n){for(var i,t=0;t<this.segments.length;t++)for(i=0;i<this.segments[t].parts.length;i++)if(this.segments[t].parts[i].name===n)return!0;return!1};i.Route=u;i.HashPathStringProvider=g;i.HistoryPathStringProvider=nt;l.prototype.createModel=function(n,t){function i(){return n.apply(this,t)}if(typeof n=="function")return i.prototype=n.prototype,new i;throw"constructor must be a valid constructor function.";};o.prototype.loadTemplate=function(n){var t=window.document.getElementById(n.templateID);if(!t)throw"There is no element with id "+n.templateID+".";if(t.tagName.toLowerCase()!=="script")throw"The element with id "+n.templateID+" must be a <script> tag in order to use it as a template.";return r.resolve({success:!0,statusCode:203,template:t})};o.prototype.unloadTemplate=function(){};i.DefaultTemplateProvider=o;s.prototype.loadTemplate=function(n){var t=window.document.getElementById(n.templateID),f=this.options.templateContainer||window.document.body,e=this;if(this.options.createTemplates&&!t&&n.templateSrc)t=window.document.createElement("script"),t.type="text/html",t.id=n.templateID,this.options.cache?t.setAttribute("data-src",n.templateSrc+"?v="+(new Date).getTime().toString()):t.setAttribute("data-src",n.templateSrc),n.templatePersist&&t.setAttribute("data-persist","true"),f.appendChild(t);else if(!t)throw"There is no template defined with id '"+n.templateID+"'";if(t.tagName.toLowerCase()!=="script")throw"The element with id "+n.templateID+" must be a <script> tag in order to use it as a template.";var u=n.templateSrc||t.getAttribute("data-src"),o=h(t,"data-loaded"),i={success:!1,statusCode:0,template:t};return new r(function(n,r){u&&!o?(e.options.cache||(u+="?v="+(new Date).getTime().toString()),jQuery.get(u).done(function(r,u,f){t.text=r;t.setAttribute("data-loaded","true");i.success=!0;i.statusCode=f.status;n(i)}).fail(function(n){i.success=!1;i.statusCode=n.status;r(i)})):(i.success=!0,i.statusCode=203,n(i))})};s.prototype.unloadTemplate=function(n){if(typeof n=="string"&&(n=window.document.getElementById(n)),!(n instanceof HTMLScriptElement))throw"The 'template' parameter must be an element ID or an HTMLScriptElement";h(n,"data-persist")||n.getAttribute("data-src")==null||(n.setAttribute("data-loaded","false"),n.text="")};typeof jQuery!="undefined"&&(i.AjaxTemplateProvider=s);e.prototype.getView=function(n){return t.utils.arrayFirst(this.views,function(t){return t.name===n})};e.prototype.addView=function(n){this.views.push(n)};e.prototype.clearViews=function(){i.utils.clearArray(this.views)};i.Area=e;i.View=tt;i.ViewRouter=it;a={init:function(n,r,u,f,e){var s=t.bindingHandlers.template.init(n,function(){return""}),o=t.utils.unwrapObservable(r());return t.computed(function(){var r=o.view(),s,h=function(){return s};if(r){if(r.content&&r.modelInstance&&r.modelInstance.error){i.utils.setTextContent(n,"<h2>Error<\/h2><p>"+r.content+"<\/p><p>"+r.modelInstance.error.stack?r.modelInstance.error.stack:"<\/p>");return}if(r.content){i.utils.setTextContent(n,r.content);return}}else{i.utils.setTextContent(n,"<h2>Error<\/h2><p>Something went wrong when trying to display content.<\/p>");return}if(s={data:r.modelInstance,name:t.unwrap(r.activeTemplateID)||r.templateID},s.data&&s.name)t.bindingHandlers.template.update(n,h,u,f,e);else throw"Failed to load view";},this,{disposeWhenNodeIsRemoved:n}).extend({rateLimit:10}),o.init(),s},update:function(){}};v()})(window,ko);
//# sourceMappingURL=knockroute.min.js.map
